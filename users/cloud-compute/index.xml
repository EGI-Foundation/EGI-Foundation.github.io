<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>EGI Docs – Cloud Compute</title>
    <link>/users/cloud-compute/</link>
    <description>Recent content in Cloud Compute on EGI Docs</description>
    <generator>Hugo -- gohugo.io</generator>
    
	  <atom:link href="/users/cloud-compute/index.xml" rel="self" type="application/rss+xml" />
    
    
      
        
      
    
    
    <item>
      <title>Users: Authentication and Authorisation</title>
      <link>/users/cloud-compute/auth/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/auth/</guid>
      <description>
        
        
        &lt;h2 id=&#34;oidc-auth-using-check-in&#34;&gt;Authentication&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;http://openid.net/connect/&#34;&gt;OpenID Connect&lt;/a&gt; is the main authentication
protocol used on the EGI Cloud. It replaces the legacy VOMS-based
authentication for all OpenStack providers.&lt;/p&gt;
&lt;p&gt;Authentication to web based services (like the AppDB) will redirect you
to the EGI Check-in authentication page. Just select your institution or
social login and follow the regular authentication process.&lt;/p&gt;
&lt;p&gt;Access to APIs or via Command Line Interfaces (CLI) requires the use of
OAuth2.0 tokens and interaction with the OpenStack Keystone
&lt;a href=&#34;https://developer.openstack.org/api-ref/identity/v3-ext/index.html#os-federation-api&#34;&gt;OS-FEDERATION
API&lt;/a&gt;.
The process for authentication is as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Obtain a valid OAuth2.0 access token from Check-in. Access tokens
are short-lived credentials that can be obtained by recognised
Check-in clients once a user has been authenticated.&lt;/li&gt;
&lt;li&gt;Interchange the Check-in access token for a valid unscoped Keystone
token.&lt;/li&gt;
&lt;li&gt;Discover available projects from Keystone using the unscoped token.&lt;/li&gt;
&lt;li&gt;Use the unscoped Keystone token to get a scoped token for a valid
project. Scoped tokens will allow the user to perform operations on
the provider.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&#34;authorisation&#34;&gt;Authorisation&lt;/h2&gt;
&lt;p&gt;Cloud Compute service is accessed through &lt;strong&gt;Virtual Organisations
(VOs)&lt;/strong&gt;. Users that are members of a VO will have access to the providers
supporting that VO: they will be able to manage VMs, block storage and
object storage available to the VO. Resources (VMs and storage) are
shared across all members of the VO, please do not interfere with the
VMs of other users if you are not entitled to do so (specially do not
delete them).&lt;/p&gt;
&lt;p&gt;Some users roles have special consideration in VOs:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Users with VO Manager, VO Deputy or VO Expert Role have extra
privileges in the AppDB for managing the Virtual Appliances to be
available at every provider. Check the &lt;a href=&#34;../vmi/&#34;&gt;Virtual Machine Image
Management documentation&lt;/a&gt; for more information.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;pilot-vo&#34;&gt;Pilot VO&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://operations-portal.egi.eu/vo/view/voname/vo.access.egi.eu&#34;&gt;vo.access.egi.eu Virtual
Organisation&lt;/a&gt;
serves as a test ground for users to try the Cloud Compute service and
to prototype and validate applications. It can be used for up to 6 month
by any new user.&lt;/p&gt;


&lt;div class=&#34;alert alert-warning&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Warning&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;After the 6-month long membership in the vo.access.egi.eu VO, you
will need to move to a production VO, or establish a new VO.&lt;/li&gt;
&lt;li&gt;The resources are not guaranteed and may be removed without notice
by providers. &lt;strong&gt;Back-up frequently to avoid losing your work!&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;p&gt;For joining this VO, just place an order in the &lt;a href=&#34;https://marketplace.egi.eu/31-cloud-compute&#34;&gt;EGI
Marketplace&lt;/a&gt; and once
approved you will be able to interact with the infrastructure.&lt;/p&gt;
&lt;h3 id=&#34;other-vos&#34;&gt;Other VOs&lt;/h3&gt;
&lt;p&gt;Pre-existing VOs of EGI can be also used on IaaS cloud providers.
Consult with your VO manager or browse the existing VOs at the &lt;a href=&#34;https://operations-portal.egi.eu/vo/&#34;&gt;EGI
Operations Portal&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;check-in-and-access-tokens&#34;&gt;Check-in and access tokens&lt;/h2&gt;
&lt;p&gt;Access tokens can be obtained via several mechanisms, usually involving
the use of a web server and a browser. Command line clients/APIs without
access to a browser or interactive prompt for user authentication can
use refresh tokens. A refresh token is a special token that is used to
generate additional access tokens. This allows you to have short-lived
access tokens without having to collect credentials every single time
one expires. You can request this token alongside the access and/or ID
tokens as part of a user&amp;rsquo;s initial authentication flow.&lt;/p&gt;
&lt;p&gt;In the case of EGI Check-in, we have created a special client meant to
obtain your personal refresh token and client credentials that will
allow the obtention of access tokens as needed. You can access the
&lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud Check-in client&lt;/a&gt; and click on
&#39;Authorise&#39; to log in with your Check-in credentials to obtain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;a client id&lt;/li&gt;
&lt;li&gt;a client secret&lt;/li&gt;
&lt;li&gt;a refresh token&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Note them down so you can use them for the next steps.&lt;/p&gt;
&lt;h3 id=&#34;discovering-projects-in-keystone&#34;&gt;Discovering projects in Keystone&lt;/h3&gt;
&lt;p&gt;The &lt;em&gt;access token&lt;/em&gt; will provide you access to a cloud provider, but you
may have access to several different projects within that provider (a
project can be considered equivalent to a VO allocation). In order to
discover which projects are available you can do that using the Keystone
API.&lt;/p&gt;
&lt;p&gt;You can use the &lt;a href=&#34;https://github.com/EGI-Foundation/egicli&#34;&gt;&lt;code&gt;egicli&lt;/code&gt;&lt;/a&gt;
to simplify the discovery of projects. First, define these variables in
your environment:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_CLIENT_ID&lt;/code&gt;: Your Check-in client id (get it from &lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud
Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_CLIENT_SECRET&lt;/code&gt;: Your Check-in client secret (get it from
&lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_REFRESH_TOKEN&lt;/code&gt;: Your Check-in refresh token (get it from
&lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;EGI_SITE&lt;/code&gt;: Name of the site (get it from
&lt;a href=&#34;https://appdb.egi.eu&#34;&gt;AppDB&lt;/a&gt;, or list it with the
&lt;code&gt;egicli endpoint list&lt;/code&gt; command)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And use them to get the list of projects:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# Export OIDC env
export CHECKIN_CLIENT_ID=&amp;lt;CLIENT_ID&amp;gt;
export CHECKIN_CLIENT_SECRET=&amp;lt;CLIENT_SECRET&amp;gt;
export CHECKIN_REFRESH_TOKEN=&amp;lt;REFRESH_TOKEN&amp;gt;
# Retrieve list of projects from site
export EGI_SITE=&amp;lt;NAME_OF_THE_SITE&amp;gt;
egicli endpoint projects
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;using-the-openstack-api&#34;&gt;Using the OpenStack API&lt;/h3&gt;
&lt;p&gt;Once you know which project to use, you can use your regular openstack
cli commands for performing actual operations in the provider:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# Export OIDC env
export CHECKIN_CLIENT_ID=&amp;lt;CLIENT_ID&amp;gt;
export CHECKIN_CLIENT_SECRET=&amp;lt;CLIENT_SECRET&amp;gt;
export CHECKIN_REFRESH_TOKEN=&amp;lt;REFRESH_TOKEN&amp;gt;
# EGI site
export EGI_SITE=&amp;lt;NAME_OF_THE_SITE&amp;gt;
export OS_PROJECT_ID=&amp;lt;PROJECT_ID&amp;gt;
# get environment variables for openstack
eval &amp;quot;$(egicli endpoint env)&amp;quot;
openstack image list
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;For 3rd party tools that can use token based authentication in
OpenStack, use the following command (after setting the environment as
shown above):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# Export OIDC env
export CHECKIN_CLIENT_ID=&amp;lt;CLIENT_ID&amp;gt;
export CHECKIN_CLIENT_SECRET=&amp;lt;CLIENT_SECRET&amp;gt;
export CHECKIN_REFRESH_TOKEN=&amp;lt;REFRESH_TOKEN&amp;gt;
# EGI site
export EGI_SITE=&amp;lt;NAME_OF_THE_SITE&amp;gt;
eval &amp;quot;$(egicli endpoint token)&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;legacy-x509-aai&#34;&gt;Legacy X.509 AAI&lt;/h2&gt;


&lt;div class=&#34;alert alert-warning&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Warning&lt;/h4&gt;
OpenID Connect is the preferred federated identity technology on EGI
Cloud. Use of X.509 certificates should be limited to legacy
applications.
&lt;/div&gt;

&lt;p&gt;&lt;a href=&#34;https://italiangrid.github.io/voms/index.html&#34;&gt;VOMS&lt;/a&gt; uses X.509 proxies
extended with VO information for authentication and authorisation on the
providers. You can learn about X.509 certificates and VOMS in the &lt;a href=&#34;../../check-in/vom&#34;&gt;Check-in
documentation&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;voms-configuration&#34;&gt;VOMS configuration&lt;/h3&gt;
&lt;p&gt;Valid configuration for &lt;code&gt;fedcloud.egi.eu&lt;/code&gt; is available on the &lt;a href=&#34;https://appdb.egi.eu/store/vappliance/egi.fedcloud.clients&#34;&gt;FedCloud
client VM&lt;/a&gt;
as generated by the &lt;a href=&#34;https://raw.githubusercontent.com/EGI-FCTF/fedcloud-userinterface/master/fedcloud-ui.sh&#34;&gt;fedcloud-ui installation
script&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;VOMS client expects your certificate and private key to be available at
&lt;code&gt;$HOME/.globus/usercert.pem&lt;/code&gt; and &lt;code&gt;$HOME/.globus/userkey.pem&lt;/code&gt;
respectively.&lt;/p&gt;
&lt;h3 id=&#34;access-the-providers&#34;&gt;Access the providers&lt;/h3&gt;
&lt;p&gt;VOMS authentication differs from one provider to another depending on
the technology used. There are 3 different cases handled automatically
by the &lt;code&gt;rOCCI-cli&lt;/code&gt;. For accessing native OpenStack sites there are two
different plugins available for Keystone that are installed with a
single library:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;pip install openstack-voms-auth-type
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;For Keystone-VOMS based installations (Keystone URL ending on &lt;code&gt;/v2.0&lt;/code&gt;),
just define the location of your proxy and &lt;code&gt;v2voms&lt;/code&gt; as authorisation
plugin:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack --os-auth-url https://&amp;lt;keystone-url&amp;gt;/v2.0 \
          --os-auth-type v2voms --os-x509-user-proxy /tmp/x509up_u1000 \
          token issue
+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field   | Value                                                                                                                                                              |
+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| expires | 2019-02-04T12:41:25+0000                                                                                                                                           |
| id      | gAAAAABcWCTlMoz6Jx9IHF5hj-ZOn-CI17CfX81FTn7yy0ZJ54jkza7QNoQTRU5-KRJkphmes55bcoSaaBRnE3g2clFgY-MR2GVUJZRkCmj9TXsLZ-hVBWXQNENiX9XxUwnavj7KqDn4b9B1K22ijTrjdDVkcdpvMw |
| user_id | 9310054c2b6f4fd28789ee08c2351221                                                                                                                                   |
+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;For those Keystone installations supporting only &lt;code&gt;v3&lt;/code&gt;, specify &lt;code&gt;v3voms&lt;/code&gt;
as authorisation plugin, &lt;code&gt;egi.eu&lt;/code&gt; as identity provider, &lt;code&gt;mapped&lt;/code&gt; as
protocol, and the location of your proxy:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack --os-auth-url https://&amp;lt;keystone url&amp;gt;/v3 \
          --os-auth-type v3voms --os-x509-user-proxy /tmp/x509up_u1000 \
          --os-identity-provider egi.eu --os-protocol mapped \
          token issue
+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Field   | Value                                                                                                                                                                                                        |
+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| expires | 2019-02-04T12:45:32+0000                                                                                                                                                                                     |
| id      | gAAAAABcWCXcXGUDpHUYnI1IDLW3MnEpDzivw_OPaau8DQDYxA7gK9XsmOqZh1pL5Uqqs8aM-tHowdJQnJURww2-UhmQVqk5PxbjdnvLeqtXPYURCLaSsbmhkQg6kB311c_ZA1jfgdT-pG6fZz3toeH66SEFX-H0bThSUy0KFLhcZVkrZIbYgTsAOIzFkTfLjOgTw_tNChS8 |
| user_id | 50fa8516b2554daeae652619ba9ebf96                                                                                                                                                                             |
+---------+----------------------------------------------------------------------------------------------------------------------------------------
&lt;/code&gt;&lt;/pre&gt;
      </description>
    </item>
    
    <item>
      <title>Users: Virtual Machine Image Management</title>
      <link>/users/cloud-compute/vmi/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/vmi/</guid>
      <description>
        
        
        &lt;p&gt;Users of the EGI Cloud create Virtual Machines (VMs) on the providers.
Those VMs are started from images: templates for the root volume of the
running instances, i.e. operating system and applications available
initially on a VM. The AppDB collects the Virtual Machine Images
available on the service as Virtual Appliances (VA).&lt;/p&gt;
&lt;p&gt;Any user can register new Virtual Appliances at the AppDB, these are
then managed by special VO members that curate which appliances are
available to their VO.&lt;/p&gt;
&lt;h2 id=&#34;appdb-cloud-marketplace&#34;&gt;AppDB Cloud Marketplace&lt;/h2&gt;
&lt;p&gt;&lt;img src=&#34;appdb_cloud.png&#34; alt=&#34;AppDB Cloud Marketplace&#34;&gt;&lt;/p&gt;
&lt;p&gt;The &lt;a href=&#34;https://appdb.egi.eu&#34;&gt;AppDB&lt;/a&gt; is a browsable catalogue of Virtual
Appliances that users can start at the providers. You can find below a
set of reference guides for the catalogue:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.appdb.egi.eu/main:faq:how_to_register_a_virtual_appliance&#34;&gt;How to register a
VA?&lt;/a&gt;:
any registered user can register VAs in AppDB for anyone to download
or for making them available at the EGI Cloud providers once a VO
adds it to the &lt;em&gt;VO-wide image list&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Once registered, VAs can be managed as described in the &lt;a href=&#34;https://wiki.appdb.egi.eu/main:guides:guide_for_managing_virtual_appliance_versions_using_the_portal&#34;&gt;VA
management
guide&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;VO managers select VAs to be available at the providers following
the &lt;a href=&#34;https://wiki.appdb.egi.eu/main:guides:manage_vo-wide_image_lists&#34;&gt;VO-wide image list
management&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check the full list of &lt;a href=&#34;https://wiki.appdb.egi.eu/main:guides#cloud_marketplace&#34;&gt;Cloud marketplace
guides&lt;/a&gt; and
&lt;a href=&#34;https://wiki.appdb.egi.eu/main:faq#cloud_marketplace&#34;&gt;Cloud marketplace
FAQ&lt;/a&gt; for more
information about the AppDB features.&lt;/p&gt;
&lt;h2 id=&#34;custom-images&#34;&gt;Custom images&lt;/h2&gt;
&lt;p&gt;Packaging your application in a custom VM image is a suggested solution
in one of the following cases:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;your particular OS flavor is not available at AppDB;&lt;/li&gt;
&lt;li&gt;installation of your application is very complex and time-consuming
for being performed during contextualization; or&lt;/li&gt;
&lt;li&gt;you want to reduce the number of &#39;moving-parts&#39; of your software
stack and follow an &lt;em&gt;immutable infrastructure&lt;/em&gt; approach for
deploying your application.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Custom VM images can be crafted in different ways. The two main
possibilities are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;start from scratch, creating a virtual machine, installing an OS and
the software on top of it, then taking the virtual machine OS disk
as custom image; or&lt;/li&gt;
&lt;li&gt;dump an existing disk from a running VM or physical server and
modify it, if needed, to run on a virtualisation platform.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this guide we will focus on the first option, because it tends to
produce cleaner images and reduces the risks of hardware conflicts.
Snapshotting may be also restricted by the cloud providers or by
security policies.&lt;/p&gt;
&lt;p&gt;Advantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Possibility to build the virtual disk directly from a legacy
machine, dumping the contents of the disk.&lt;/li&gt;
&lt;li&gt;Possibility to speed-up the deployment for applications with complex
and big installation packages. This because you do not need to
install the application at startup, but the application is already
included in the machine.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Disadvantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Building a virtual disk directly from a legacy machine poses a set of
compatibility issues with hardware drivers, which usually differs
from a virtual and physical environment and even between different
virtual environments.&lt;/li&gt;
&lt;li&gt;You need to keep your machine updated. Outdated VM disk images may
take a long time to startup due to the need to download and install
the latest OS updates.&lt;/li&gt;
&lt;li&gt;If you are using special drivers or you are not packaging correctly
the disk, your custom VM image may not run (or run slowly) on
different cloud providers based on different virtualisation
technologies.&lt;/li&gt;
&lt;li&gt;VM images on public clouds are sometimes public, thus be
aware of installing proprietary software on custom images, since
other users may be able to run the image or download it.&lt;/li&gt;
&lt;li&gt;In general, the effort to implement this solution is higher than the
basic contextualization.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;image-size-and-layout&#34;&gt;Image size and layout&lt;/h3&gt;
&lt;p&gt;The larger the VM image, the longer it will take to be distributed to
the providers and the longer it will take to be started on the
infrastructure. As a general rule, always try to make images as smaller
as possible following these guidelines:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO NOT&lt;/strong&gt; include (big) data in your image. There are other
mechanisms for accessing data from your VM (block/object storage,
&lt;a href=&#34;https://www.gridpp.ac.uk/wiki/RALnonLHCCVMFS&#34;&gt;CVMFS&lt;/a&gt;)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO NOT&lt;/strong&gt; include (big) empty space or swap in your image. Extra
space for your computation or swap can be added with block storage
once the VM is booted or using VM flavors that have extra disk
allocated for your VM.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO NOT&lt;/strong&gt; install un-needed software. Tools like GUI are of no-use
in most cases since you will have no access to the graphical console
of the VM.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO&lt;/strong&gt; adjust the size of the images as much as possible. As stated
above, empty space can be allocated on runtime easily.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO&lt;/strong&gt; use compressed image formats, like qcow2 or vmdk (used in
OVA) to minimize the size of the image. Preferred format for images
in EGI is OVA as it&#39;s standardised.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO&lt;/strong&gt; fill with &lt;code&gt;0&lt;/code&gt; the empty disk space of your image so when
compressed it can be significantly reduced, e.g. using:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;dd if=/dev/zero of=/bigemptyfile bs=4096k
rm -rf /bigemptyfile
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;DO&lt;/strong&gt; use a single partition (no /boot, no swap) for the disk
layout and avoid LVM. This will allow the cloud provider to easily
resize your partition when instantiated and to modify files in it if
needed.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;contextualization-and-credentials&#34;&gt;Contextualization and credentials&lt;/h3&gt;


&lt;div class=&#34;alert alert-danger&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Danger&lt;/h4&gt;
&lt;strong&gt;Do NOT include any credentials on your images&lt;/strong&gt;.
&lt;/div&gt;

&lt;p&gt;You should never include any kind of credentials on your images, instead
you should use contextualization.
&lt;a href=&#34;https://cloudinit.readthedocs.io/en/latest/&#34;&gt;cloud-init&lt;/a&gt; is a tool that
will simplify the contextualization process for you. This is widely
available as packages in major OS distributions and is supported by all
the providers of the EGI Cloud and most of the commercial providers.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://cloudinit.readthedocs.io/en/latest/&#34;&gt;cloud-init&lt;/a&gt;
documentation contains detailed examples on how to create users, run
scripts, install packages and several other actions supported by the
tool.&lt;/p&gt;
&lt;p&gt;For complex setups, especially when applications involve multiple VMs it
may be useful to use cloud-init to bootstrap some &lt;a href=&#34;https://en.wikipedia.org/wiki/Comparison_of_open-source_configuration_management_software&#34;&gt;Configuration
Management
Software&lt;/a&gt;
that will manage the configuration of the VMs during runtime.&lt;/p&gt;
&lt;h3 id=&#34;security&#34;&gt;Security&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Always remove all default passwords and accounts from your VM.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Disable all services unless necessary for the intended tasks.&lt;/li&gt;
&lt;li&gt;Make sure the firewall configuration (iptables for Linux, also on
IPv6) is minimally open.&lt;/li&gt;
&lt;li&gt;Put no shared credentials (passwords) in any image.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You should also follow the best practice guides for each service that&#39;s
exposed to the outside world. See for example guides for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://wiki.centos.org/HowTos/Network/SecuringSSH&#34;&gt;ssh&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.owasp.org/index.php/Securing_tomcat&#34;&gt;tomcat&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;See also &lt;a href=&#34;https://aws.amazon.com/whitepapers/aws-security-best-practices/&#34;&gt;AWS security Best
Practices&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;tools&#34;&gt;Tools&lt;/h3&gt;
&lt;p&gt;Whenever possible, automate the process of creating your images. This
will allow you to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;get reproducible results&lt;/li&gt;
&lt;li&gt;avoid tedious manual installation steps&lt;/li&gt;
&lt;li&gt;quickly produce updated versions of your images.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;EGI uses &lt;a href=&#34;https://packer.io&#34;&gt;packer&lt;/a&gt; as a tool for automating the
creation of our base images. This tool can use
&lt;a href=&#34;https://www.virtualbox.org/&#34;&gt;VirtualBox&lt;/a&gt; as a hypervisor for the creation
of the images and guarantees identical results under different platforms
and providers.&lt;/p&gt;
&lt;p&gt;Check the &lt;a href=&#34;https://github.com/EGI-Foundation/fedcloud-vmi-templates&#34;&gt;fedcloud-vmi-templates github
repo&lt;/a&gt; with all
the packer recipes used to build our images and re-use them as needed
for your images.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: VMOps Dashboard</title>
      <link>/users/cloud-compute/vmops/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/vmops/</guid>
      <description>
        
        
        &lt;p&gt;The &lt;a href=&#34;https://appdb.egi.eu/&#34;&gt;EGI Application Database (AppDB)&lt;/a&gt; includes a
web GUI for management of Virtual Machines (VMs) on the federated
infrastructure.&lt;/p&gt;
&lt;p&gt;This GUI is available for a set of &lt;a href=&#34;https://wiki.appdb.egi.eu/main:faq:which_vos_are_supported_by_the_vmops_dashboard&#34;&gt;selected
VOs&lt;/a&gt;.
If your VO is not listed and you are interested in getting support,
please &lt;a href=&#34;https://ggus.eu&#34;&gt;open a ticket&lt;/a&gt; or contact us at
&lt;code&gt;support _at_ egi.eu&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;main-user-features&#34;&gt;Main user features&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;User identification with Check-in, with customised view of the VAs
and resource providers based on the VO membership of the user.&lt;/li&gt;
&lt;li&gt;Management of VMs in &lt;em&gt;topologies&lt;/em&gt;, containing one or more instances
of a given VA.&lt;/li&gt;
&lt;li&gt;Attachment of additional block storage to the VM instances.&lt;/li&gt;
&lt;li&gt;Start/Stop VMs without destroying the VM (for all VMs of a topology
or for individual instances within a topology)&lt;/li&gt;
&lt;li&gt;Single control of topologies across the whole federation.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;quick-start&#34;&gt;Quick start&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Log into the &lt;a href=&#34;https://dashboard.appdb.egi.eu/vmops&#34;&gt;VMOps dashboard&lt;/a&gt;
using EGI Check-in.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Click on &amp;quot;Create a new VM Topology&amp;quot; to start the topology builder,
this will guide you through a set of steps:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Select the Virtual Appliance you want to start, these are the
same shown in the &lt;a href=&#34;https://appdb.egi.eu/browse/cloud&#34;&gt;AppDB Cloud
Marketplace&lt;/a&gt;, you can use the
search field to find your VA;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;vmops_va_select.png&#34; alt=&#34;Select the VA&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;select the VO to use when instantiating the VA;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;select the provider where to instantiate the VA; and finally&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;1.  select the template (VM instance type) of the instance that will
determine the number of cores, memory and disk space used in
your VM.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Now you will be presented with a summary page where you can further
customise your VM by:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Adding more VMs to the topology&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Adding block storage devices to the VMs&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Define contextualisation parameters (e.g. add new users, execute
some script)&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;vmops_settings.png&#34; alt=&#34;Topology settings&#34;&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Click on &amp;quot;Launch&amp;quot; and your deployment will be submitted to the
infrastructure.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The topology you just created will appear on your &amp;quot;Topologies&amp;quot; with
all the details about it, clicking on a VM of a topology will give you
details about its status and IP. VMOps will create a default &lt;code&gt;cloudadm&lt;/code&gt;
user for you and create ssh-key pair for login (you can create as many
users as needed with the contextualisation options of the wizard
described above).&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;vmops_vm.png&#34; alt=&#34;VM details&#34;&gt;&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: Using OpenStack providers</title>
      <link>/users/cloud-compute/openstack/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/openstack/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;https://openstack.org&#34;&gt;OpenStack&lt;/a&gt; providers of the EGI Cloud Compute
service offer native OpenStack features via native APIs integrated with
EGI Check-in accounts.&lt;/p&gt;
&lt;p&gt;The extensive &lt;a href=&#34;https://docs.openstack.org/user/&#34;&gt;OpenStack user
documentation&lt;/a&gt; includes details on
every OpenStack project, most providers offer access to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;keystone, for identity&lt;/li&gt;
&lt;li&gt;nova, for VM management&lt;/li&gt;
&lt;li&gt;glance, for VM image management&lt;/li&gt;
&lt;li&gt;cinder, for block storage&lt;/li&gt;
&lt;li&gt;neutron, for network management&lt;/li&gt;
&lt;li&gt;horizon, as a web dashboard&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Web-dashboard of the integrated providers can be accessed using your EGI
Check-in credentials directly: select &lt;em&gt;OpenID Connect&lt;/em&gt; or &lt;em&gt;EGI Check-in&lt;/em&gt;
in the &lt;strong&gt;Authenticate using&lt;/strong&gt; drop-down menu of the login screen. You
can explore &lt;a href=&#34;https://docs.openstack.org/horizon/rocky/user/&#34;&gt;Horizon dashboard
documentation&lt;/a&gt; for more
information on how to manage your resources from the browser. The rest
of this guide will focus on CLI/API access.&lt;/p&gt;
&lt;h2 id=&#34;installation&#34;&gt;Installation&lt;/h2&gt;
&lt;p&gt;TBC&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;pip install requests
pip install openstackclient
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;code&gt;jq&lt;/code&gt; to easily manage JSON output&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Add IGTF CA to python&#39;s CA store:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;cat /etc/grid-security/certificates/*.pem &amp;gt;&amp;gt; $(python -m requests.certs)
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;authentication&#34;&gt;Authentication&lt;/h2&gt;
&lt;p&gt;Check the documentation at &lt;code&gt;oidc-auth-using-check-in&lt;/code&gt;{.interpreted-text
role=&amp;quot;ref&amp;rdquo;} on how to get the right credentials for accessing the
providers.&lt;/p&gt;
&lt;h3 id=&#34;openstack-token-for-other-clients&#34;&gt;OpenStack token for other clients&lt;/h3&gt;
&lt;p&gt;Most OpenStack clients allow authentication with tokens, so you can
easily use them with EGI Cloud providers just doing a first step for
obtaining the token. With the OpenStack client you can use the following
command to set the OS_TOKEN variable with the needed token:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;$ OS_TOKEN=$(openstack --os-auth-type v3oidcaccesstoken \
            --os-protocol openid --os-identity-provider egi.eu \
            --os-auth-url &amp;lt;keystone  url&amp;gt; \
            --os-access-token &amp;lt;your access token&amp;gt; \
            --os-project-id &amp;lt;your project id&amp;gt; token issue -c id -f value)
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can refresh the access token and obtain an OpenStack token in a
single &lt;code&gt;../get-token.py&lt;/code&gt;{.interpreted-text role=&amp;quot;download&amp;rdquo;} script
expecting your credentials to be available in the environment:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_CLIENT_ID&lt;/code&gt;: Your Check-in client id (get it from &lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud
Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_CLIENT_SECRET&lt;/code&gt;: Your Check-in client secret (get it from
&lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;CHECKIN_REFRESH_TOKEN&lt;/code&gt;: Your Check-in refresh token (get it from
&lt;a href=&#34;https://aai.egi.eu/fedcloud&#34;&gt;FedCloud Check-in client&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;OS_AUTH_URL&lt;/code&gt;: Keystone URL (depends on the provider, you can get it
in &lt;a href=&#34;https://goc.egi.eu&#34;&gt;GOCDB&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;OS_PROJECT_ID&lt;/code&gt;: OpenStack project to use (See script above for
obtaining it)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Optionally set the &lt;code&gt;CHECKIN_URL&lt;/code&gt; to the Check-in endpoint
(e.g. &lt;code&gt;https://aai-dev.egi.eu/&lt;/code&gt; if testing on the devel environment).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# Export OIDC env
export CHECKIN_CLIENT_ID=&amp;lt;CLIENT_ID&amp;gt;
export CHECKIN_CLIENT_SECRET=&amp;lt;CLIENT_SECRET&amp;gt;
export CHECKIN_REFRESH_TOKEN=&amp;lt;REFRESH_TOKEN&amp;gt;
# Select OpenStack endpoint
export OS_AUTH_URL=&amp;lt;OPENSTACK_URL&amp;gt;
# Retrieve project ID
python get-projects.py
export OS_PROJECT_ID=&amp;lt;PROJECT_ID&amp;gt;
# Retrieve OpenStack token
export OS_TOKEN=$(python get-token.py)
echo $OS_TOKEN
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;useful-commands-with-openstack-cli&#34;&gt;Useful commands with OpenStack CLI&lt;/h2&gt;
&lt;p&gt;Please refer to the &lt;a href=&#34;https://docs.openstack.org/nova/rocky/user/&#34;&gt;nova
documentation&lt;/a&gt; for a
complete guide on the VM management features of OpenStack. We list in
the sections below some useful commands for the EGI Cloud.&lt;/p&gt;
&lt;h3 id=&#34;registering-an-existing-ssh-key&#34;&gt;Registering an existing ssh key&lt;/h3&gt;
&lt;p&gt;It&#39;s possible to register an ssh key that can later be used as the
default ssh key for the default user of the VM (via the &lt;code&gt;--key-name&lt;/code&gt;
argument to &lt;code&gt;openstack server create&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack keypair create --public-key ~/.ssh/id_rsa.pub mykey
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;creating-a-vm&#34;&gt;Creating a VM&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack flavor list
FLAVOR=&amp;lt;FLAVOR_NAME&amp;gt;
openstack image list
IMAGE_ID=&amp;lt;IMAGE_ID&amp;gt;
openstack network list
# Pick FedCloud network
NETWORK_ID=&amp;lt;NETOWRK_ID&amp;gt;
openstack security group list
openstack server create --flavor $FLAVOR --image $IMAGE_ID \
  --nic net-id=$NETWORK_ID --security-group default \
  --key-name mykey oneprovider
# Creating a floating IP
openstack floating ip create &amp;lt;NETOWRK_NAME&amp;gt;
# Assigning floating IP to server
openstack server add floating ip &amp;lt;SERVER_ID&amp;gt; &amp;lt;IP&amp;gt;
# Removing floating IP from server
openstack server show &amp;lt;SERVER_ID&amp;gt;
# Deleting server
openstack server remove floating ip &amp;lt;SERVER_ID&amp;gt; &amp;lt;IP&amp;gt;
openstack server delete &amp;lt;SERVER_ID&amp;gt;
# Deleting floating IP
openstack floating ip delete &amp;lt;IP&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.openstack.org/mitaka/install-guide-obs/launch-instance-provider.html&#34;&gt;OpenStack: launch an instance on the provider
network&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.openstack.org/ocata/user-guide/cli-manage-ip-addresses.html&#34;&gt;OpenStack: Manging IP
addresses&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;using-cloud-init&#34;&gt;Using cloud-init&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack server create --flavor m3.medium \
  --image d0a89aa8-9644-408d-a023-4dcc1148ca01 \
  --user-data userdata.txt --key-name My_Key server01.example.com
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.openstack.org/nova/queens/user/user-data.html&#34;&gt;OpenStack: providing user data
(cloud-init)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudinit.readthedocs.io/en/latest/index.html&#34;&gt;cloudinit
documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;shell-script-data-as-user-data&#34;&gt;Shell script data as user data&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.shell}&#34; data-lang=&#34;{.shell}&#34;&gt;#!/bin/sh
adduser --disabled-password --gecos &amp;quot;&amp;quot; clouduser
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id=&#34;cloud-config-data-as-user-data&#34;&gt;cloud-config data as user data&lt;/h4&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.yaml}&#34; data-lang=&#34;{.yaml}&#34;&gt;#cloud-config
hostname: mynode
fqdn: mynode.example.com
manage_etc_hosts: true
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://cloudinit.readthedocs.io/en/latest/topics/examples.html#yaml-examples&#34;&gt;Official cloud-config
examples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.zetta.io/en/help/articles-tutorials/customizing-instance-deployment-cloud-init/&#34;&gt;Cloud-init
example&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;creating-a-snapshot-image-from-running-vm&#34;&gt;Creating a snapshot image from running VM&lt;/h3&gt;
&lt;p&gt;You can create a new image from a snapshot of an existing VM that will
allow you to easily recover a previous version of your VM or to use it
as a template to clone a given VM.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack server image create &amp;lt;your VM&amp;gt; --name &amp;lt;name of the snapshot&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Once the snapshot is ready
(&lt;code&gt;openstack image show &amp;lt;name of the snapshot&amp;gt;&lt;/code&gt; will give your the
details you can use it as any other image at the provider:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack server create --flavor &amp;lt;flavor&amp;gt; \
  --image &amp;lt;name of the snapshot&amp;gt; \
  &amp;lt;name of the new VM&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;You can override files in the snapshot if needed, e.g. changing the SSH
keys:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;openstack server create --flavor &amp;lt;flavor&amp;gt; \
  --image &amp;lt;name of the snapshot&amp;gt; \
  --file /home/ubuntu/.ssh/authorized_keys=my_new_keys \
  &amp;lt;name of the new VM&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id=&#34;terraform&#34;&gt;Terraform&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://terraform.io&#34;&gt;Terraform&lt;/a&gt; supports EGI Cloud OpenStack providers
by using valid access tokens for Keystone. For using this, just
configure your provider as usual in Terraform, but do not include
user/password information:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.terraform}&#34; data-lang=&#34;{.terraform}&#34;&gt;# Configure the OpenStack Provider
provider &amp;quot;openstack&amp;quot; {
  project_id = &amp;quot;&amp;lt;your project id&amp;gt;&amp;quot;
  auth_url    = &amp;quot;http://&amp;lt;your keystone url&amp;gt;/v3&amp;quot;
}

# Create a server
resource &amp;quot;openstack_compute_instance_v2&amp;quot; &amp;quot;test-server&amp;quot; {
  # ...
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;when launching Terraform, set the &lt;code&gt;OS_TOKEN&lt;/code&gt; environment variable to a
valid token as shown in :ref:OpenStack token for other clients. You may
also set the Keystone URL and project id in the &lt;code&gt;OS_AUTH_URL&lt;/code&gt; and
&lt;code&gt;OS_PROJECT_ID&lt;/code&gt; environment variables:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.terraform}&#34; data-lang=&#34;{.terraform}&#34;&gt;provider &amp;quot;openstack&amp;quot; {
}

data &amp;quot;openstack_images_image_v2&amp;quot; &amp;quot;ubuntu16&amp;quot; {
  most_recent = true

  properties {
    APPLIANCE_MPURI = &amp;quot;https://appdb.egi.eu/store/vo/image/8df7ba00-8467-57aa-bf1e-05754a2a73bf:6428/&amp;quot;
  }
}

data &amp;quot;openstack_compute_flavor_v2&amp;quot; &amp;quot;small&amp;quot; {
  vcpus = 1
  ram   = 2048
  disk  = 20
}

resource &amp;quot;openstack_compute_instance_v2&amp;quot; &amp;quot;vm&amp;quot; {
  name = &amp;quot;testvm&amp;quot;
  image_id = &amp;quot;${data.openstack_images_image_v2.ubuntu16.id}&amp;quot;
  flavor_id = &amp;quot;${data.openstack_compute_flavor_v2.small.id}&amp;quot;
  security_groups = [&amp;quot;default&amp;quot;]
}
&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;$ export CHECKIN_CLIENT_ID=&amp;lt;CLIENT_ID&amp;gt;
$ export CHECKIN_CLIENT_SECRET=&amp;lt;CLIENT_SECRET&amp;gt;
$ export CHECKIN_REFRESH_TOKEN=&amp;lt;REFRESH_TOKEN&amp;gt;
$ export OS_AUTH_URL=&amp;lt;OPENSTACK_URL&amp;gt;
$ export OS_PROJECT_ID=&amp;lt;PROJECT_ID&amp;gt;
$ export OS_TOKEN=$(python get-token.py)
$ terraform plan
Refreshing Terraform state in-memory prior to plan...
The refreshed state will be used to calculate this plan, but will not be
persisted to local or remote state storage.

data.openstack_compute_flavor_v2.small: Refreshing state...
data.openstack_images_image_v2.ubuntu16: Refreshing state...

------------------------------------------------------------------------

An execution plan has been generated and is shown below.
Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  + openstack_compute_instance_v2.vm
      id:                         &amp;lt;computed&amp;gt;
      access_ip_v4:               &amp;lt;computed&amp;gt;
      access_ip_v6:               &amp;lt;computed&amp;gt;
      all_metadata.%:             &amp;lt;computed&amp;gt;
      availability_zone:          &amp;lt;computed&amp;gt;
      flavor_id:                  &amp;quot;2&amp;quot;
      flavor_name:                &amp;lt;computed&amp;gt;
      force_delete:               &amp;quot;false&amp;quot;
      image_id:                   &amp;quot;ceb0434d-37af-4d1f-9efe-13f6f9937df2&amp;quot;
      image_name:                 &amp;lt;computed&amp;gt;
      name:                       &amp;quot;testvm&amp;quot;
      network.#:                  &amp;lt;computed&amp;gt;
      power_state:                &amp;quot;active&amp;quot;
      region:                     &amp;lt;computed&amp;gt;
      security_groups.#:          &amp;quot;1&amp;quot;
      security_groups.3814588639: &amp;quot;default&amp;quot;
      stop_before_destroy:        &amp;quot;false&amp;quot;


Plan: 1 to add, 0 to change, 0 to destroy.

------------------------------------------------------------------------

Note: You didn&#39;t specify an &amp;quot;-out&amp;quot; parameter to save this plan, so Terraform
can&#39;t guarantee that exactly these actions will be performed if
&amp;quot;terraform apply&amp;quot; is subsequently run.
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Note that as in the example above you can get images using information
from AppDB if needed.&lt;/p&gt;
&lt;h2 id=&#34;libcloud&#34;&gt;libcloud&lt;/h2&gt;
&lt;p&gt;&lt;a href=&#34;https://libcloud.apache.org/index.html&#34;&gt;Apache libcloud&lt;/a&gt; support
OpenStack and EGI authentication mechanisms by setting the
&lt;code&gt;ex_force_auth_version&lt;/code&gt; to &lt;code&gt;3.x_oidc_access_token&lt;/code&gt; or &lt;code&gt;2.0_voms&lt;/code&gt;
respectively. Check the &lt;a href=&#34;https://libcloud.readthedocs.io/en/latest/compute/drivers/openstack.html#connecting-to-the-openstack-installation&#34;&gt;libcloud docs on connecting to
OpenStack&lt;/a&gt;
for details. See below two code samples for using them&lt;/p&gt;
&lt;h3 id=&#34;openid-connect&#34;&gt;OpenID Connect&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.python}&#34; data-lang=&#34;{.python}&#34;&gt;import requests

from libcloud.compute.types import Provider
from libcloud.compute.providers import get_driver

refresh_data = {
    &#39;client_id&#39;: &#39;&amp;lt;your client_id&amp;gt;&#39;,
    &#39;client_secret&#39;: &#39;&amp;lt;your client_secret&amp;gt;&#39;,
    &#39;grant_type&#39;: &#39;refresh_token&#39;,
    &#39;refresh_token&#39;: &#39;&amp;lt;your refresh_token&amp;gt;&#39;,
    &#39;scope&#39;: &#39;openid email profile&#39;,
}

r = requests.post(&amp;quot;https://aai.egi.eu/oidc/token&amp;quot;,
                  auth=(client_id, client_secret),
                  data=refresh_data)

access_token = r.json()[&#39;access_token&#39;]

OpenStack = get_driver(Provider.OPENSTACK)
# first parameter is the identity provider: &amp;quot;egi.eu&amp;quot;
# Second parameter is the access_token
# The protocol &#39;openid&#39; is specified in ex_tenant_name, and tenant/project cannot be selected :(
driver = OpenStack(&#39;egi.eu&#39;, access_token, ex_tenant_name=&#39;openid&#39;,
                   ex_force_auth_url=&#39;https://keystone_url:5000&#39;,
                   ex_force_auth_version=&#39;3.x_oidc_access_token&#39;)
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id=&#34;voms&#34;&gt;VOMS&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.python}&#34; data-lang=&#34;{.python}&#34;&gt;from libcloud.compute.types import Provider
from libcloud.compute.providers import get_driver

OpenStack = get_driver(Provider.OPENSTACK)
# assume your proxy is available at /tmp/x509up_u1000
# you can obtain a proxy with the voms-proxy-init command
# no need for username
driver = OpenStack(None, &#39;/tmp/x509up_u1000&#39;, ex_tenant_name=&#39;EGI_FCTF&#39;,
                   ex_force_auth_url=&#39;https://sbgcloud.in2p3.fr:5000&#39;,
                   ex_force_auth_version=&#39;2.0_voms&#39;)
&lt;/code&gt;&lt;/pre&gt;
      </description>
    </item>
    
    <item>
      <title>Users: Storage</title>
      <link>/users/cloud-compute/storage/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/storage/</guid>
      <description>
        
        
        &lt;p&gt;If you are in need of more storage than the one provided within image
disk of your VMs, or need to persist data independently from the VMs
storage, you will need to use one of the solutions available as part
of the &lt;a href=&#34;../../online-storage/&#34;&gt;EGI online storage service&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This page describes the Block Storage offering of the online
storage which is only accessible from VMs running on the EGI Cloud.&lt;/p&gt;
&lt;h2 id=&#34;block-storage&#34;&gt;Block Storage&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Block storage&lt;/strong&gt; provides additional storage blocks which can be
attached to a virtual machine. A storage block is a virtual disk of a
given size, which can be exposed as a virtual device in the VM. You can
think of this can of devices as a USB stick that can be plugged into the
VMs and can be used as a regular drive. You can format it with any file
system you want and mount it in your VM. Block devices are persistent,
thus they keep all the data after VM shutdown and need to be explicitly
destroyed when data is not needed anymore. Block storage disks can be
accessed only from within a VM, and only from VMs running at the same
provider where the block storage is located. Also, they can be accessed
by only one VM at the same time. As part of the IaaS service, block
storage is managed via OpenStack/OCCI APIs. There is a limit on the
number of block storage devices you can attach on a VM and there is a
limit to the maximum size of such virtual disks. These values will
depend on the particular provider and your SLA. Moreover, the disk space
is accounted for the entire block storage device, regardless how much of
it is actually used.&lt;/p&gt;
&lt;p&gt;Block storage is created and managed via requests to specific APIs. Once
the storage is attached to a VM, it is managed as a regular disk that
can be used as any other disk from within the VM.&lt;/p&gt;
&lt;h3 id=&#34;management&#34;&gt;Management&lt;/h3&gt;
&lt;p&gt;OpenStack providers offer block storage using their native API. Both the
CLI client or dashboard can be used. Main commands for managing volumes
are listed below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Command&lt;/th&gt;
&lt;th&gt;function&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;volume create --size &amp;lt;size&amp;gt; &amp;lt;name&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;create a volume of size &lt;code&gt;&amp;lt;size&amp;gt;&lt;/code&gt; GBs and name &lt;code&gt;&amp;lt;name&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;volume list&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;list available volumes&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;volume show &amp;lt;volume&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;show details of a given volume&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;volume delete &amp;lt;volume&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;deletes a volume&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;server add volume &amp;lt;server&amp;gt; &amp;lt;volume&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Attach a volume to a server&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;server remove volume &amp;lt;server&amp;gt; &amp;lt;volume&amp;gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Dettach a volume from a server&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;For using the legacy OCCI interface refer to &lt;a href=&#34;https://wiki.egi.eu/wiki/HOWTO11_How_to_use_the_rOCCI_Client#How_to_create_block_storage.3F&#34;&gt;OCCI
How-to&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;using-block-storage-from-your-vms&#34;&gt;Using block storage from your VMs&lt;/h3&gt;
&lt;p&gt;Block Storage will appear as block devices into your VM. Usually these
devices are empty upon creation. The first time you attach them to a VM,
you will need to partition and create filesystems on the device.&lt;/p&gt;
&lt;p&gt;You can just create a filesystem on the block device with the following
command (run this at your VM!).&lt;/p&gt;


&lt;div class=&#34;alert alert-danger&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Danger&lt;/h4&gt;
Only run this command the first time you use the device, it deletes all
data!
&lt;/div&gt;

&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# mkfs.ext4 /dev/&amp;lt;volume device&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The &lt;code&gt;&amp;lt;volume device&amp;gt;&lt;/code&gt; (e.g &lt;code&gt;vdb&lt;/code&gt;) can be obtained with the
&lt;code&gt;openstack volume show&lt;/code&gt; command&lt;/p&gt;
&lt;p&gt;Once you have a filesystem you can mount it at the desired path:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;# mount /dev/&amp;lt;volume device&amp;gt; /&amp;lt;path&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;With that you can access &lt;code&gt;/&amp;lt;path&amp;gt;&lt;/code&gt; where all your data will be
available. Applications will not see any difference between a block
storage device and a regular disk, thus no major changes should be
required in the application logic.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: GPUs</title>
      <link>/users/cloud-compute/gpgpu/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/gpgpu/</guid>
      <description>
        
        
        &lt;h1 id=&#34;gpu-resources-on-egi-cloud&#34;&gt;GPU resources on EGI Cloud&lt;/h1&gt;
&lt;p&gt;GPUs resources are available on selected providers of the EGI Cloud. These are
available as specific &lt;strong&gt;flavours&lt;/strong&gt; that when used to instantiate a Virtual
Machine will make the hardware available to the user.&lt;/p&gt;
&lt;p&gt;The table below summarises the available options:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Site&lt;/th&gt;
&lt;th&gt;VM configuration options&lt;/th&gt;
&lt;th&gt;Flavors&lt;/th&gt;
&lt;th&gt;Supported VOs with GPUs&lt;/th&gt;
&lt;th&gt;Access conditions&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;IISAS-GPUCloud&lt;/td&gt;
&lt;td&gt;up to 2 NVIDIA Tesla K20m&lt;/td&gt;
&lt;td&gt;gpu1cpu6, gpu2cpu12&lt;/td&gt;
&lt;td&gt;acc-comp.egi.eu, eosc-synergy.eu, enmr.eu, training.egi.eu&lt;/td&gt;
&lt;td&gt;Sponsored access for limited testing, conditions to be negotiated for long-term usage&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IISAS-Nebula&lt;/td&gt;
&lt;td&gt;up to 2 NVIDIA Tesla K20m&lt;/td&gt;
&lt;td&gt;resource_tpl#large_gpu&lt;/td&gt;
&lt;td&gt;acc-comp.egi.eu, biomed&lt;/td&gt;
&lt;td&gt;Sponsored access for limited testing, conditions to be negotiated for long-term usage&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IFCA-LCG2&lt;/td&gt;
&lt;td&gt;up to 4 NVIDIA GT200GL, up to 1 NVIDIA TITAN X, up to 10 NVIDIA GeForce GTX 1080Ti&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Pay-per-use&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CESNET-MCC&lt;/td&gt;
&lt;td&gt;up to 2 NVIDIA T4&lt;/td&gt;
&lt;td&gt;hpc.8core-64ram-nvidia-1080-glados, hpc.19core-176ram-nvidia-1080-glados, hpc.38core-372ram-nvidia-1080-glados, hpc.19core-176ram-nvidia-2080-glados, hpc.38core-372ram-nvidia-2080-glados&lt;/td&gt;
&lt;td&gt;vo.clarin.eu, biomed, eosc-synergy.eu, peachnote.com&lt;/td&gt;
&lt;td&gt;Sponsored, conditions to be negotiated&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;access-to-gpu-resources-on-egi-cloud&#34;&gt;Access to GPU resources on EGI Cloud&lt;/h1&gt;
&lt;p&gt;GPUs sites can be accessed by different ways: via site-specific dashboards and
endpoints or via common federated-cloud services like common Horizon dashboard,
VMOps dashboard, or Infrastructure manager.&lt;/p&gt;
&lt;p&gt;Site-specific dashboards and endpoints are described in the following table:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Site&lt;/th&gt;
&lt;th&gt;Openstack Horizon dashboard&lt;/th&gt;
&lt;th&gt;Keystone endpoint&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;IISAS-GPUCloud&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://nova3.ui.savba.sk/horizon&#34;&gt;https://nova3.ui.savba.sk/horizon&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://keystone3.ui.savba.sk&#34;&gt;https://keystone3.ui.savba.sk&lt;/a&gt;:5000/&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IFCA-LCG2&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://portal.cloud.ifca.es/&#34;&gt;https://portal.cloud.ifca.es/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://api.cloud.ifca.es&#34;&gt;https://api.cloud.ifca.es&lt;/a&gt;:5000/&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CESNET-MCC&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://dashboard.cloud.muni.cz/&#34;&gt;https://dashboard.cloud.muni.cz/&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://identity.cloud.muni.cz/&#34;&gt;https://identity.cloud.muni.cz/&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;A VM image with pre-installed NVIDIA driver and Docker is available at
&lt;a href=&#34;https://appdb.egi.eu/store/vappliance/nvidia.docker.centos.7&#34;&gt;AppDB&lt;/a&gt;. Some VOs
(acc-comp.egi.eu, eosc-synergy.eu) have the image included in the VO image list.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: EC3</title>
      <link>/users/cloud-compute/ec3/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/ec3/</guid>
      <description>
        
        
        &lt;p&gt;&lt;a href=&#34;http://servproject.i3m.upv.es/ec3/&#34;&gt;EC3&lt;/a&gt; (Elastic Cloud Compute Cluster) is a
tool to create elastic virtual clusters on Infrastructure as a Service
(IaaS) providers. It supports the provisioning of clusters running TORQUE,
SLURM, SGE, HTCondor, Mesos, Nomad, Kubernetes and others that will be
automatically resized to fit the load (e.g. number of jobs at the batch system).&lt;/p&gt;
&lt;p&gt;This section of the documentation will guide you on how to use EC3 with EGI Cloud
providers using the OpenStack API and OpenID Connect for deploying your clusters.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: Federation Architecture and Implementation</title>
      <link>/users/cloud-compute/federation/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/federation/</guid>
      <description>
        
        
        &lt;p&gt;The EGI Federated Cloud is a multi-national cloud system that integrates
community, private and/or public clouds into a scalable computing
platform for research. The Federation pools services from a
heterogeneous set of cloud providers using a single authentication and
authorisation framework that allows the portability of workloads across
multiple providers and enable bringing computing to data. The current
implementation is focused on IaaS services but can be easily applied to
PaaS and SaaS layers.&lt;/p&gt;
&lt;p&gt;Each resource centre of the federated infrastructure operates a &lt;em&gt;Cloud
Management Framework (CMF)&lt;/em&gt; according to its own preferences and
constraints and joins the federation by integrating this CMF with
components of the EGI service portfolio. CMFs must at least be
integrated with EGI AAI so users can access services with a single
identity, integration with other components and APIs to be provided are
agreed by the community the resource centre provides services to.&lt;/p&gt;
&lt;p&gt;EGI follows a Service Integration and Management (SIAM) approach to
manage the federation with processes that cover the different aspects of
the IT Service Management. Providers in the federation keep complete
control of their services and resources. EGI VO OLAs establish a
reliable, trust-based communication channel between the Customer and the
providers to agree on the services, their levels and the types of
support. The EGI VO OLAs are not legal contracts but, as agreements,
they outline the clear intentions to collaborate and support research.&lt;/p&gt;
&lt;h2 id=&#34;federated-iaas&#34;&gt;Federated IaaS&lt;/h2&gt;
&lt;p&gt;The EGI Federated Cloud Infrastructure as a Service (IaaS) resource
centres deploy a Cloud Management Framework (CMF) that provide users
with an API-based service for management of Virtual Machines and
associated Block Storage to enable persistence and Networks to enable
connectivity of the Virtual Machines among themselves and third party
resources.&lt;/p&gt;
&lt;p&gt;The IaaS federation is a thin layer that brings the providers together
with:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;federated authentication;&lt;/li&gt;
&lt;li&gt;resource discovery;&lt;/li&gt;
&lt;li&gt;central VM image catalogue;&lt;/li&gt;
&lt;li&gt;usage accounting; and&lt;/li&gt;
&lt;li&gt;monitoring.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The IaaS capabilities (VM, block storage, network management) must be
provided via community agreed APIs (OpenStack and/or OCCI are supported
at the moment) that allow integration with EGI Check-in for
authentication and authorisation of users. Those providers that limit
the interaction to web dashboards and do not expose APIs to direct
consumption for users cannot be considered part of the EGI IaaS Cloud
Compute service.&lt;/p&gt;
&lt;p&gt;The information system provides a real-time view about the actual
capabilities of federation participants. The EGI Configuration Database
(GOCDB) contains the list of resource centres and their entry endpoints.
Information about these endpoints is expressed in a standard format
(GlueSchema 2.1) and pushed to consumers via the Argo Messaging System.
The AppDB Information System collects this information in a central
service for discovery.&lt;/p&gt;
&lt;p&gt;Users can instantiate VMs on the providers from a set of Virtual Machine
Images available on a central catalogue implemented in AppDB&#39;s Cloud
Marketplace. Virtual Machine Images are synchronised to the providers
periodically using the HEPiX image lists format.&lt;/p&gt;
&lt;p&gt;Usage of resources is gathered centrally using EGI Accounting repository
and available for visualisation at &lt;a href=&#34;https://accounting.egi.eu&#34;&gt;EGI Accounting
portal&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Those endpoints published in the EGI Configuration Database are
monitored via &lt;a href=&#34;https://argoeu.github.io/&#34;&gt;ARGO&lt;/a&gt;. The set of probes check
the availability of the providers and their correct functionality.&lt;/p&gt;
&lt;p&gt;Users and Community platforms built on top of the EGI IaaS can interact
with the cloud providers at three different layers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Directly using the IaaS APIs to manage individual resources. This
option is recommended for pre-existing use cases with requirements
on specific APIs.&lt;/li&gt;
&lt;li&gt;Using IaaS Federated Access Tools that allow managing the complexity
of dealing with different providers in a uniform way. These tools
include:
&lt;ul&gt;
&lt;li&gt;IaaS provisioning systems that allow to define infrastructure as
code and manage and combine resources from different providers,
thus enabling the portability of application deployments between
them (e.g. IM or Terraform); and&lt;/li&gt;
&lt;li&gt;cloud brokers, that provide matchmaking for workloads to
available providers (e.g. the INDIGO-DataCloud Orchestrator).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Using the AppDB VMOps dashboard, a web-based GUI that simplifies the
management of VMs on any provider of the EGI infrastructure. AppDB
VMOps in turn relies on the Infrastructure Manager.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;EGI provides ready-to-use software components to enable the federation
for OpenStack and OpenNebula. These components rely on public APIs of
the IaaS system and use Check-in accounts for authenticating into the
provider.&lt;/p&gt;
&lt;h2 id=&#34;implementation&#34;&gt;Implementation&lt;/h2&gt;
&lt;h3 id=&#34;aai&#34;&gt;AAI&lt;/h3&gt;
&lt;p&gt;Federated identity ensures that users of the federation can use a single
account for accessing the resources.&lt;/p&gt;
&lt;h4 id=&#34;openid-connect&#34;&gt;OpenID Connect&lt;/h4&gt;
&lt;p&gt;Providers of the EGI Cloud support authentication with OAuth2.0 tokens
provided by Check-in OpenID Connect Identity provider. Support builds on
the &lt;a href=&#34;https://wiki.egi.eu/wiki/AAI_guide_for_SPs&#34;&gt;AAI guide for SPs&lt;/a&gt; with
detailed configuration provided at the &lt;a href=&#34;https://egi-federated-cloud-integration.readthedocs.io/en/latest/openstack.html#openid-connect-support&#34;&gt;EGI Cloud integration
manual&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The integration relies on the OpenStack Keystone &lt;a href=&#34;https://developer.openstack.org/api-ref/identity/v3-ext/index.html#os-federation-api&#34;&gt;OS-FEDERATION
API&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;legacy-voms--x509-certificates&#34;&gt;Legacy VOMS / X.509 certificates&lt;/h4&gt;
&lt;p&gt;EGI can support users still using X.509 certificates extended with VO
attributes (e.g. acknowledging that the user is member of the VO) in a
so called VOMS proxy. This VOMS proxy certificate is used in subsequent
calls to the endpoints which map the certificate and VO information via
specific integration modules for VOMS authentication.&lt;/p&gt;
&lt;p&gt;There are two implementations for the support of VOMS proxies:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/the-rocci-project/keystorm&#34;&gt;KeyStorm&lt;/a&gt; provides
federated authentication for OpenNebula/rOCCI.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/IFCA/Keystone-VOMS&#34;&gt;Keystone-VOMS&lt;/a&gt; is an
OpenStack Keystone plugin to enable VOMS authentication. It allows
users to get tokens which can be used to access any of the OpenStack
services. Users are generated on the fly in Keystone, it does not
need regular synchronization with the VO Management server Perun.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;information-discovery&#34;&gt;Information discovery&lt;/h3&gt;
&lt;p&gt;The information system provides a real-time view about the actual
capabilities of federation participants. The information system can be
used by both human users and online services.&lt;/p&gt;
&lt;h4 id=&#34;configuration-database&#34;&gt;Configuration DataBase&lt;/h4&gt;
&lt;p&gt;EGI&amp;rsquo;s central configuration database (&lt;a href=&#34;https://goc.egi.eu&#34;&gt;GOCDB&lt;/a&gt;) is
used to catalogue the static information of the production
infrastructure topology. To allow Resource Providers to expose IaaS
federation endpoints, the following service types are avialable:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;org.openstack.nova&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;&lt;code&gt;org.openstack.swift&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;&lt;code&gt;eu.egi.cloud.accounting&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;&lt;code&gt;eu.egi.cloud.vm-management.occi&lt;/code&gt;, and&lt;/li&gt;
&lt;li&gt;&lt;code&gt;eu.egi.cloud.vm-metadata.marketplace&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;All providers &lt;strong&gt;must&lt;/strong&gt; enter cloud service endpoints to GOCDB to enable
integration with EGI..&lt;/p&gt;
&lt;p&gt;The
&lt;a href=&#34;https://github.com/EGI-Foundation/cloud-info-provider&#34;&gt;Cloud-info-provider&lt;/a&gt;
extracts information from the resource centres using their native APIs
and formats it following Glue, and OGC recommended standard. This
information is pushed to the Argo Messaging System and consumed by AppDB
to provide a central information discovery service that aggregates
several other sources of information of the infrastructure on a single
endpoint.&lt;/p&gt;
&lt;h3 id=&#34;virtual-machine-image-management&#34;&gt;Virtual Machine Image management&lt;/h3&gt;
&lt;p&gt;In a distributed, federated IaaS service, users need solutions for
efficiently managing and distributing their VM Images across multiple
resource providers. EGI provides a catalogue of Virtual Machine images
(VMIs) that allows any user to share their VMI and communities to select
those relevant for distribution across providers. These images are
automatically replicated at the providers supporting the community and
converted as needed to ensure the correct instantiation when used.&lt;/p&gt;
&lt;p&gt;AppDB includes a Virtual Appliance Marketplace supporting Virtual
Appliances (VAs), which are clean-and mean virtual machine images
designed to run on a virtualisation platform, that provide a software
solution out-of-the-box, ready to be used with minimal or no set-up
within the IaaS providers.&lt;/p&gt;
&lt;p&gt;AppDB allows representatives of research communities (VOs) to generate a
VM image list via GUI that resource centres subscribe to. The
subscription enables the periodic download, conversion and storage of
those images in the local IaaS image repository.
&lt;a href=&#34;https://github.com/the-cloudkeeper-project/cloudkeeper&#34;&gt;cloudkeeper&lt;/a&gt;
provides this automated synchronisation between AppDB and
OpenStack/OpenNebula.&lt;/p&gt;
&lt;h3 id=&#34;accounting&#34;&gt;Accounting&lt;/h3&gt;
&lt;p&gt;Federated Accounting provides an integrated view about resource/service
usage: it pulls together usage information from the federated sites and
services, integrates the data and presents them in such a way that both
individual users as well as whole communities can monitor their own
resource/service usage across the whole federation.&lt;/p&gt;
&lt;h4 id=&#34;cloud-usage-record&#34;&gt;Cloud Usage Record&lt;/h4&gt;
&lt;p&gt;The federated cloud task force has agreed on a Cloud Usage Record, which
inherits from the &lt;a href=&#34;https://www.ogf.org/documents/GFD.98.pdf&#34;&gt;OGF Usage
Record&lt;/a&gt;. This record defines
the data that resource providers must send to EGI&amp;rsquo;s central Accounting
repository.&lt;/p&gt;
&lt;p&gt;Version 0.4 of the Cloud Accounting Usage Record was agreed at the
FedCloud Face to Face in Amsterdam in January 2015. A summary table of
the format is shown below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Cloud Usage Record Property&lt;/th&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Null&lt;/th&gt;
&lt;th&gt;Definition&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VMUUID&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;Virtual Machine&#39;s Universally Unique Identifier concatenation of CurrentTime, SiteName and MachineName&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SiteName&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;GOCDB SiteName - GOCDB now has cloud service types and a cloud-only site is allowed.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CloudComputeService (NEW)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Name identifying cloud resource within the site. Allows multiple cloud resources within a sitei.e. a level of granularity.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MachineName&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;VM Id - the site name for the VM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LocalUserId&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Local user name&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LocalGroupId&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Local group name&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GlobalUserName&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Global identity of user (certificate DN)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FQAN&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Use if VOs part of authorization mechanism&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Status&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Completion status - completed, started or suspended&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;StartTime&lt;/td&gt;
&lt;td&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Must be set when Status = started&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EndTime&lt;/td&gt;
&lt;td&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Set to NULL until Status = completed&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SuspendDuration&lt;/td&gt;
&lt;td&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Set when Status = suspended (Timestamp)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WallDuration&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;WallClock time - actual time used&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CpuDuration&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;CPU time consumed (Duration)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CpuCount&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Number of CPUs allocated&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NetworkType&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Needs clarifying&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NetworkInbound&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;GB received&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NetworkOutbound&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;GB sent&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PublicIPCount (NEW)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Number of public IP addresses assigned to VM &lt;strong&gt;Not used&lt;/strong&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Memory&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Memory allocated to the VM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Disk&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Size in GB allocated to the VM&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;BenchmarkType (NEW)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Name of benchmark used for normalization of times (eg HEPSPEC06)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Benchmark (NEW)&lt;/td&gt;
&lt;td&gt;&lt;code&gt;Decimal&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Value of benchmark of VM using ServiceLevelType benchmark’&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;StorageRecordId&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Link to other associated storage record &lt;em&gt;Need to check feasibility&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ImageId&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Every image has a unique ID associated with it.&lt;br&gt;For images from the EGI FedCloud AppDB this should be &lt;code&gt;VMCATCHER_EVENT_AD_MPURI&lt;/code&gt;&lt;br&gt;For images from other repositories it should be a vmcatcher equivalent&lt;br&gt;For local images - local identifier of the image.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CloudType&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt; &lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;Type of cloud infrastructure: OpenNebula; OpenStack; Synnefo; etc.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;public-ip-usage-record&#34;&gt;Public IP Usage Record&lt;/h4&gt;
&lt;p&gt;The fedcloud task force has agreed on an IP Usage Record. The format
uses many of the same fields as the Cloud Usage Record. The Usage Record
should be a &amp;quot;snapshot&amp;quot; of the number of IPs currently assigned to a
user. A table defining v0.2 of the format is shown below:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Cloud Usage Record Property&lt;/th&gt;
&lt;th&gt;Type&lt;/th&gt;
&lt;th&gt;Null&lt;/th&gt;
&lt;th&gt;Definition&lt;/th&gt;
&lt;th&gt;Notes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;MeasurementTime&lt;/td&gt;
&lt;td&gt;&lt;code&gt;datetime&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;The time the usage was recorded.&lt;/td&gt;
&lt;td&gt;In the message format, must be a UNIX timestamp, i.e. the number of seconds that have elapsed since 00:00:00 Coordinated Universal Time (UTC), Thursday, 1 January 1970)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SiteName&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;The GOCDB site assigning the IP&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CloudComputeService&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Yes&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CloudType&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LocalUser&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LocalGroup&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GlobalUserName&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FQAN&lt;/td&gt;
&lt;td&gt;&lt;code&gt;varchar(255)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;See Cloud Usage Record&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IPVersion&lt;/td&gt;
&lt;td&gt;&lt;code&gt;byte&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;4 or 6&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;IPCount&lt;/td&gt;
&lt;td&gt;&lt;code&gt;int(11)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;No&lt;/td&gt;
&lt;td&gt;The number of IP addresses of IPVersion this user currently assigned to them&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;A JSON schema defining a valid Public IP Usage message can be found at:
&lt;a href=&#34;https://github.com/apel/apel/blob/9476bd86424f6162c3b87b6daf6b4270ceb8fea6/apel/db/__init__.py&#34;&gt;https://github.com/apel/apel/blob/9476bd86424f6162c3b87b6daf6b4270ceb8fea6/apel/db/__init__.py&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&#34;apel-and-accounting-portal&#34;&gt;APEL and accounting portal&lt;/h4&gt;
&lt;p&gt;Once generated, records are delivered to the central accounting
repository using APEL SSM (Secure STOMP Messenger). SSM client packages
can be obtained at &lt;a href=&#34;https://apel.github.io&#34;&gt;https://apel.github.io&lt;/a&gt;. A Cloud Accounting Summary
Usage Record has also been defined and summaries created on a daily
basis from all the accounting records received from the Resource
Providers are sent to the EGI Accounting Portal. The &lt;a href=&#34;http://accounting.egi.eu/&#34;&gt;Accounting
portal&lt;/a&gt; also runs SSM to receive these
summaries and provides a web view of the accounting data received from
the Resource Providers.&lt;/p&gt;
&lt;h4 id=&#34;accounting-probes&#34;&gt;Accounting Probes&lt;/h4&gt;
&lt;p&gt;Implementation of the extactor probes for accounting are listed below:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OpenNebula:
&lt;a href=&#34;https://github.com/the-oneacct-export-project/oneacct-export&#34;&gt;https://github.com/the-oneacct-export-project/oneacct-export&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;OpenStack: &lt;a href=&#34;https://github.com/IFCA/caso&#34;&gt;https://github.com/IFCA/caso&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;monitoring&#34;&gt;Monitoring&lt;/h3&gt;
&lt;p&gt;Services in the EGI infrastructure are monitored via [ARGO](&amp;lt;https://argo.egi.eu/).
Specific probes to check functionality and availability of services must be
provided by service developers, The current set of probes used for monitoring
IaaS resources consists of:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;OCCI probes (&lt;code&gt;eu.egi.cloud.OCCI-VM&lt;/code&gt; and
&lt;code&gt;eu.egi.cloud.OCCI-Context&lt;/code&gt;): OCCI-VM creates an instance of a given
image by using OCCI, checks its status and deletes it afterwards.
OCCI-Context checks that the OCCI interfaces correctly supports the
standard and the FedCloud contextualization extension.&lt;/li&gt;
&lt;li&gt;Accounting probe (&lt;code&gt;eu.egi.cloud.APEL-Pub&lt;/code&gt;): Checks if the cloud
resource is publishing data to the Accounting repository&lt;/li&gt;
&lt;li&gt;TCP checks (&lt;code&gt;org.nagios.Broker-TCP&lt;/code&gt;, &lt;code&gt;org.nagios.CDMI-TCP&lt;/code&gt;,
&lt;code&gt;org.nagios.OCCI-TCP&lt;/code&gt; and &lt;code&gt;org.nagios.CloudBDII-Check&lt;/code&gt;): Basic TCP
checks for services.&lt;/li&gt;
&lt;li&gt;VM Marketplace probe (&lt;code&gt;eu.egi.cloud.AppDB-Update&lt;/code&gt;): gets a
predetermined image list from AppDB and checks its update interval.&lt;/li&gt;
&lt;li&gt;Perun probe (&lt;code&gt;eu.egi.cloud.Perun-Check&lt;/code&gt;): connects to the server and
checks the status by using internal Perun interface&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;roadmap&#34;&gt;Roadmap&lt;/h2&gt;
&lt;p&gt;The TCB-Cloud board defines the roadmap for the technical evolution of
the EGI Cloud. All the components are continuously maintained to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Improve their programmability, providing complete APIs specification
in adequate format for facilitating the generation clients (e.g.
following the OpenAPI initiative and Swagger).&lt;/li&gt;
&lt;li&gt;Lower the barriers to integrate and operate resource centres in the
federation by a) minimizing the number of components used; b)
contributing code to upstream distributions; and c) use only public
APIs of the Cloud Management Frameworks.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Currently the EGI FedCloud TaskForce is focused on moving to a central
operations model, where providers only need to integrate their system
with EGI Check-in but do not need to deploy and configure the different
tools (accounting, discovery, VMI management, etc.) locally but delegate
this to a central EGI team.&lt;/p&gt;

      </description>
    </item>
    
    <item>
      <title>Users: FAQ</title>
      <link>/users/cloud-compute/faq/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>/users/cloud-compute/faq/</guid>
      <description>
        
        
        &lt;h2 id=&#34;basics&#34;&gt;Basics&lt;/h2&gt;
&lt;h3 id=&#34;how-can-i-get-access-to-the-egieu-federated-cloud&#34;&gt;How can I get access to the EGI.eu Federated Cloud?&lt;/h3&gt;
&lt;p&gt;There is a VO available for 6 months piloting activities that any
researcher in Europe can join. Just place an order into the &lt;a href=&#34;https://marketplace.egi.eu/31-cloud-compute&#34;&gt;EGI
Marketplace&lt;/a&gt;.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-get-an-oauth20-token&#34;&gt;How can I get an OAuth2.0 token?&lt;/h3&gt;
&lt;p&gt;Authentication via CLI or API requires a valid Check-in token. The
FedCloud Check-in client allows you to get one as needed. Check the
&lt;code&gt;auth&lt;/code&gt;{.interpreted-text role=&amp;quot;doc&amp;rdquo;} guide for more information.&lt;/p&gt;
&lt;h3 id=&#34;is-occi-still-supported&#34;&gt;Is OCCI still supported?&lt;/h3&gt;
&lt;p&gt;OCCI is now deprecated as API for the EGI Cloud providers using
OpenStack. If you still rely on OCCI for your access, please contact us
at &lt;code&gt;support _at_ egi.eu&lt;/code&gt; for support on the migration. OpenNebula sites
still use OCCI as main API, but its direct use is not recommended as the
support will be deprecated. Instead use an Orchestrator like IM for
interacting with those sites.&lt;/p&gt;
&lt;h2 id=&#34;discovery&#34;&gt;Discovery&lt;/h2&gt;
&lt;h3 id=&#34;how-can-i-get-the-list-of-the-egi-cloud-providers&#34;&gt;How can I get the list of the EGI Cloud providers?&lt;/h3&gt;
&lt;p&gt;The list of certified providers is available in
&lt;a href=&#34;https://goc.egi.eu&#34;&gt;GOCDB&lt;/a&gt;. The &lt;code&gt;egicli endpoint list&lt;/code&gt; command can help
you to get that list:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;$ egicli endpoint list
Site                type                URL
------------------  ------------------  ------------------------------------------------
IFCA-LCG2           org.openstack.nova  https://api.cloud.ifca.es:5000/v3/
IN2P3-IRES          org.openstack.nova  https://sbgcloud.in2p3.fr:5000/v3
UA-BITP             org.openstack.nova  https://openstack.bitp.kiev.ua:5000/v3
RECAS-BARI          org.openstack.nova  https://cloud.recas.ba.infn.it:5000/v3
NCG-INGRID-PT       org.openstack.nova  https://nimbus.ncg.ingrid.pt:5000/v3
CLOUDIFIN           org.openstack.nova  https://cloud-ctrl.nipne.ro:443/v3
IISAS-GPUCloud      org.openstack.nova  https://keystone3.ui.savba.sk:5000/v3/
IISAS-FedCloud      org.openstack.nova  https://nova.ui.savba.sk:5000/v3/
UNIV-LILLE          org.openstack.nova  https://thor.univ-lille.fr:5000/v3
INFN-PADOVA-STACK   org.openstack.nova  https://egi-cloud.pd.infn.it:443/v3
CYFRONET-CLOUD      org.openstack.nova  https://api.cloud.cyfronet.pl:5000/v3/
SCAI                org.openstack.nova  https://fc.scai.fraunhofer.de:5000/v3
CESNET-MCC          org.openstack.nova  https://identity.cloud.muni.cz/v3
INFN-CATANIA-STACK  org.openstack.nova  https://stack-server.ct.infn.it:35357/v3
CESGA               org.openstack.nova  https://fedcloud-osservices.egi.cesga.es:5000/v3
100IT               org.openstack.nova  https://cloud-egi.100percentit.com:5000/v3/
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The providers also generate dynamic information about their
characteristics via the Argo Messaging System which is easily browsable
from AppDB.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-choose-which-site-to-use&#34;&gt;How can I choose which site to use?&lt;/h3&gt;
&lt;p&gt;Sites offer their resources to users through Virtual Organisations (VO).
First, you need to join a Virtual Organisation that matches your
research interests, see &lt;code&gt;authorisation&lt;/code&gt;{.interpreted-text role=&amp;quot;ref&amp;rdquo;}
section on how VOs work. AppDB shows the supported VOs and for each VO
you can browse the resource providers that support it.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-get-information-about-the-available-vm-images&#34;&gt;How can I get information about the available VM images?&lt;/h3&gt;
&lt;p&gt;The &lt;a href=&#34;https://appdb.egi.eu&#34;&gt;Application Database&lt;/a&gt; contains information
about the VM images available in the EGI Cloud. Within the AppDB Cloud
Marketplace, you can look for a VM and get all the information about
which VO the VM is associated, the sites where the VM is available and
the endpoints and identifiers to use it in practice.&lt;/p&gt;
&lt;h2 id=&#34;managing-vms&#34;&gt;Managing VMs&lt;/h2&gt;
&lt;h3 id=&#34;the-disk-on-my-vm-is-full-how-can-i-get-more-space&#34;&gt;The disk on my VM is full, how can I get more space?&lt;/h3&gt;
&lt;p&gt;There are several ways to increase the disk space available at the VM.
The fastest and easiest one is to use block storage, creating a new
storage disk device and attaching it to the VM. Check the
&lt;code&gt;storage&lt;/code&gt;{.interpreted-text role=&amp;quot;doc&amp;rdquo;} guide for more information.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-keep-my-data-after-the-vm-is-stopped&#34;&gt;How can I keep my data after the VM is stopped?&lt;/h3&gt;
&lt;p&gt;After a VM has been stopped and unless backed up in a block storage
volume, all data in the VM is destroyed and cannot be recovered. To
ensure your data will be available after the VM is deleted, you need to
use some form of persistent storage.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-assign-a-public-ip-to-my-vm&#34;&gt;How can I assign a public IP to my VM?&lt;/h3&gt;
&lt;p&gt;Some providers do not automatically assign a public IP address to a VM
during the creation phase. In this case, you can attach a public IP by
first allocating a new public IP and then assigning it to the VM.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-assign-a-dns-name-to-my-vm&#34;&gt;How can I assign a DNS name to my VM?&lt;/h3&gt;
&lt;p&gt;If you need a domain name for your VMs, we offer a Dynamic DNS service
that allows any EGI user to create names for VMs under the
&lt;em&gt;fedcloud.eu&lt;/em&gt; domain.&lt;/p&gt;
&lt;p&gt;Just go to &lt;a href=&#34;https://nsupdate.fedcloud.eu&#34;&gt;EGI Cloud nsupdate&lt;/a&gt; and login
with your Check-in account. Once in, you can click on &amp;quot;Add host&amp;quot; to
register a new hostname in an available domain.&lt;/p&gt;
&lt;h3 id=&#34;what-is-contextualisation&#34;&gt;What is contextualisation?&lt;/h3&gt;
&lt;p&gt;The contextualisation of is the process of installing, configuring and
preparing software upon boot time on a pre-defined virtual machine
image. This way, the pre-defined images can be stored as generic and
small as possible, since customisations will take place on boot time.&lt;/p&gt;
&lt;p&gt;Contextualisation is particularly useful for:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Configuration not known until instantiation (e.g. data location).&lt;/li&gt;
&lt;li&gt;Private Information (e.g. host certs)&lt;/li&gt;
&lt;li&gt;Software that changes frequently or under development.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The contextualisation requires passing some data to the VMs on
instantiation (the context) and handling that context in the VM.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-inject-my-public-ssh-key-into-the-machine&#34;&gt;How can I inject my public SSH key into the machine?&lt;/h3&gt;
&lt;p&gt;The best way to login into the virtual server is to use SSH keys. If you
don&#39;t have one, you need to generate it with the &lt;code&gt;ssh-keygen&lt;/code&gt; command:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.console}&#34; data-lang=&#34;{.console}&#34;&gt;ssh-keygen -f fedcloud
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This will generate two files:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;fedcloud&lt;/code&gt;, the private key. This file should never be shared&lt;/li&gt;
&lt;li&gt;&lt;code&gt;fedcloud.pub&lt;/code&gt;, the public key. That will be sent to your VM.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To inject the public SSH key into the VM you can use the
&lt;code&gt;key-name&lt;/code&gt; option when creating the VM in OpenStack. Check
&lt;a href=&#34;https://docs.openstack.org/python-openstackclient/pike/cli/command-objects/keypair.html&#34;&gt;keypair
management&lt;/a&gt;
option in OpenStack documentation. This key will be available for the
default configured user of the VM (e.g. &lt;code&gt;ubuntu&lt;/code&gt; for Ubuntu, &lt;code&gt;centos&lt;/code&gt;
for CentOS).&lt;/p&gt;
&lt;p&gt;You can also create users with keys with a contextualisation file:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.yaml}&#34; data-lang=&#34;{.yaml}&#34;&gt;#cloud-config
users:
  - name: cloudadm
    sudo: ALL=(ALL) NOPASSWD:ALL
    lock-passwd: true
    ssh-import-id: cloudadm
    ssh-authorized-keys:
      - &amp;lt;paste here the contents of your SSH key pub file&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert alert-warning&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Warning&lt;/h4&gt;
YAML format requires that the spaces at the beginning of each line is
respected in order to be correctly parsed by &lt;code&gt;cloud-init&lt;/code&gt;.
&lt;/div&gt;

&lt;h3 id=&#34;how-can-i-use-a-contextualisation-file&#34;&gt;How can I use a contextualisation file?&lt;/h3&gt;
&lt;p&gt;If you have a contextualisation file, you can use it with the
&lt;code&gt;--user-data&lt;/code&gt; option to &lt;code&gt;server create&lt;/code&gt; in OpenStack.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-{.shell}&#34; data-lang=&#34;{.shell}&#34;&gt;$ openstack server create --flavor &amp;lt;your-flavor&amp;gt; --image &amp;lt;your image&amp;gt; \
            --user-data &amp;lt;your contextualisation file&amp;gt; \
            &amp;lt;server name&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;div class=&#34;alert alert-info&#34; role=&#34;alert&#34;&gt;
&lt;h4 class=&#34;alert-heading&#34;&gt;Note&lt;/h4&gt;
We recommend using &lt;code&gt;cloud-init&lt;/code&gt; for contextualisation. EGI images in
AppDB do support &lt;code&gt;cloud-init&lt;/code&gt;. Check the
&lt;a href=&#34;https://cloudinit.readthedocs.io/&#34;&gt;documentation&lt;/a&gt; for more
information.
&lt;/div&gt;

&lt;h3 id=&#34;how-can-i-pass-secrets-to-my-vms&#34;&gt;How can I pass secrets to my VMs?&lt;/h3&gt;
&lt;p&gt;EGI Cloud endpoints use https so information passed to contextualise the
VMs can be assumed to be safe and only readable within your VM. However,
take into account that anyone with access to the VM may be able to
access also the contextualisation information.&lt;/p&gt;
&lt;h3 id=&#34;how-can-i-use-ansible&#34;&gt;How can I use ansible?&lt;/h3&gt;
&lt;p&gt;Ansible relies on ssh for accessing the servers it will configure. VMs
at EGI Cloud can be also accessed via ssh, just make sure you inject the
correct public keys in the VMs to be able to access.&lt;/p&gt;
&lt;p&gt;If you don&#39;t have public IPs for all the VMs to be managed, you can
also use one as a gateway as described in the &lt;a href=&#34;https://docs.ansible.com/ansible/latest/reference_appendices/faq.html#how-do-i-configure-a-jump-host-to-access-servers-that-i-have-no-direct-access-to&#34;&gt;Ansible
FAQ&lt;/a&gt;.&lt;/p&gt;

      </description>
    </item>
    
  </channel>
</rss>
